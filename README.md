# Ishtar Gate

Проект для статистического моделирования и анализа совпадений между парами случайных «карточек» с числами от 1 до 20.

## Цель проекта

Цель — получить **распределение совпадений** при сравнении двух пар карточек в условиях случайной генерации:

- Каждая карточка содержит **4 различных числа** из диапазона 1–20.
- Для каждой пары «левая карточка — правая карточка» считается, сколько чисел левой карточки встречаются на правой (0, 1, 2, 3 или 4 совпадения).
- Процесс выполняется для **двух независимых пар** карточек (карта 1 и карта 2).
- В итоге подсчитывается, в скольких случаях получилась комбинация совпадений вида **(k₁, k₂)** — например, «4 совпадения на первой паре и 4 на второй» (4×4), «3 и 3» (3×3) и т.д.

Таким образом, проект позволяет оценить вероятности различных исходов при случайном выборе карточек и может использоваться для анализа игр, лотерей или иных сценариев с подобной механикой.

## Вероятностная модель лото «4 из 20»

По сути это расчёт **вероятностной модели лото «4 из 20»**.

В такой лотерее:
- на билете и в тираже участвуют числа от **1 до 20**;
- на билете зафиксированы **4 разных числа** (одна карточка);
- в тираже случайно выпадают **4 разных числа** — выигрышная комбинация;
- результат билета определяется тем, **сколько чисел билета совпало с выпавшими** (0, 1, 2, 3 или 4).

В коде это отражено так:
- **«Левая» карточка** — аналог **билета** игрока (4 числа от 1 до 20 без повторов).
- **«Правая» карточка** — аналог **выигрышной комбинации** одного тиража (4 числа от 1 до 20 без повторов).
- Для каждой пары (билет, тираж) считается число совпадений — это и есть **количество угаданных чисел «из 4»** в одном тираже.

Моделируются **два независимых тиража** лото «4 из 20»: для каждой пары карточек считается исход первого тиража (сколько совпадений на первой карточке — `sum_c1`) и исход второго (сколько на второй — `sum_c2`). Затем считается **совместное распределение** этих двух исходов:
- **4×4** — в первом тираже 4 совпадения и во втором 4 (два «полных» выигрыша);
- **3×3** — в обоих тиражах по 3 совпадения;
- **2×2**, **3×4**, **2×4**, **1×4**, **0×4**, **2×3**, **1×3**, **0×3**, **1×2**, **0×2** — остальные комбинации (первое число — совпадения в первом тираже, второе — во втором).

Итог: проект считает вероятностную модель лото «4 из 20» в варианте «два независимых тиража» и методом Монте-Карло оценивает, как часто встречается каждая комбинация (k₁, k₂) совпадений.

## Что делает проект

1. **Генерация карточек**
   - Создаются «левые» и «правые» карточки: по 4 числа от 1 до 20 в каждой, без повторов внутри карточки.
   - Левые карточки генерируются через случайную матрицу с последующей отбраковкой строк с повторяющимися числами.
   - Правые карточки строятся функцией `create_random_4()`: одна случайная четвёрка уникальных чисел тиражируется на нужное количество карточек.

2. **Подсчёт совпадений**
   - Для каждой пары (левая карта 1, правая карта 1) считается число совпадений (0–4) — `sum_c1`.
   - Аналогично для второй пары (карта 2) — `sum_c2`.

3. **Агрегация по комбинациям**
   - Подсчитывается количество карточек, попавших в каждую комбинацию (sum_c1, sum_c2):
     - **4×4** — 4 совпадения на первой и 4 на второй паре
     - **3×3**, **2×2**
     - **3×4 / 4×3**, **2×4 / 4×2**, **1×4 / 4×1**, **0×4 / 4×0**
     - **2×3 / 3×2**, **1×3 / 3×1**, **0×3 / 3×0**
     - **1×2 / 2×1**, **0×2 / 2×0**

4. **Результат**
   - Функция `gen_random_values(random_cards)` возвращает список из 12 чисел — количества карточек в каждой из этих категорий.

## Структура репозитория

| Файл / каталог | Назначение |
|----------------|------------|
| `main.py` | Точка входа: 100 прогонов по 10 000 000 карточек, вывод результата каждого прогона |
| `math4x20.py` | Генерация карточек, подсчёт совпадений и агрегация по комбинациям (4×4, 3×3, …) |
| `requirements.txt` | Зависимости Python (numpy, pandas и др.) |
| `.gitignore` | Исключение каталога `venv/` из репозитория |

## Зависимости

- Python 3
- **numpy** — генерация случайных чисел и массивы
- **pandas** — таблицы и фильтрация данных

Остальные пакеты из `requirements.txt` (Cython, randomgen, timeloop и т.д.) могут использоваться в расширениях или сборке; для базового запуска достаточно numpy и pandas.

Установка:

```bash
pip install -r requirements.txt
```

## Запуск

Из корня проекта:

```bash
python main.py
```

Скрипт выполнит 100 итераций, на каждой итерации сгенерирует указанное в коде число карточек (по умолчанию 10 000 000), посчитает распределение совпадений и выведет список из 12 чисел — количества по категориям 4×4, 3×3, 2×2, 3×4/4×3, 2×4/4×2, 1×4/4×1, 0×4/4×0, 2×3/3×2, 1×3/3×1, 0×3/3×0, 1×2/2×1, 0×2/2×0.

## Основные функции (math4x20.py)

| Функция | Описание |
|--------|----------|
| `gen_random_values(random_cards)` | Генерирует карточки, считает совпадения и возвращает список из 12 счётчиков по комбинациям |
| `create_random_4(repeat_count)` | Создаёт одну случайную четвёрку уникальных чисел от 1 до 20 и тиражирует её в матрицу размера `repeat_count × 4` |
| `math4x4(all_cards)` … `math0x2or2x0(all_cards)` | Подсчёт числа карточек с заданной комбинацией совпадений (4×4, 3×3, …, 0×2/2×0) |

## Примечания

- Размер выборки для левых карточек задаётся с коэффициентом 1.4 (`random_cards * 1.4`) с последующей обрезкой до `random_cards`, чтобы после отбраковки строк с повторами осталось достаточно строк.
- Правая карточка во всех парах одной «серии» одна и та же (одна четвёрка повторяется); левые карточки у разных пар различаются. Это заложено в текущей логике модели.
